///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2022, ООО 1С-Софт
// Все права защищены. Эта программа и сопроводительные материалы предоставляются
// в соответствии с условиями лицензии Attribution 4.0 International (CC BY 4.0)
// Текст лицензии доступен по ссылке:
// https://creativecommons.org/licenses/by/4.0/legalcode
///////////////////////////////////////////////////////////////////////////////////////////////////////

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если НЕ Параметры.Свойство("ОткрытаПоСценарию") Тогда
		ВызватьИсключение "Обработка не предназначена для непосредственного использования.";
	КонецЕсли;

	ПропуститьЗавершениеРаботы = Параметры.ПропуститьЗавершениеРаботы;

	Элементы.ТекстСообщения.Заголовок	= Параметры.ТекстСообщения;
	СистемнаяИнформация					= Новый СистемнаяИнформация;
	Текущая								= СистемнаяИнформация.ВерсияПриложения;
	Минимальная							= Параметры.МинимальнаяВерсияПлатформы;
	Рекомендуемая						= Параметры.РекомендуемаяВерсияПлатформы;

	Элементы.ТекстСообщения.Заголовок = СтрШаблон(Элементы.ТекстСообщения.Заголовок, Минимальная);

	НомерВерсии					= Рекомендуемая;
	ПродолжениеРаботыНевозможно	= Ложь;
	Если БазоваяПодсистемаКлиентСервер.ОН_СравнитьВерсии(Текущая, Минимальная) < 0 Тогда
		ТекстУсловие				= "необходимо";
		ПродолжениеРаботыНевозможно	= Истина;
		НомерВерсии					= Минимальная;
	Иначе
		ТекстУсловие				= "рекомендуется";
	КонецЕсли;
	Элементы.Версия.Заголовок = СтрШаблон(Элементы.Версия.Заголовок, ТекстУсловие, НомерВерсии, СистемнаяИнформация.ВерсияПриложения);

	Если ПродолжениеРаботыНевозможно Тогда
		Элементы.ТекстВопроса.Видимость	= Ложь;
		Элементы.ФормаНет.Видимость		= Ложь;
		Заголовок						= "Необходимо обновить версию платформы";
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПриЗакрытии(ЗавершениеРаботы)
	Если Не ДействиеОпределено Тогда
		ДействиеОпределено = Истина;

		Если НЕ ПропуститьЗавершениеРаботы Тогда
			ПрекратитьРаботуСистемы();
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ТекстСсылкиНажатие(Элемент)
	ОткрытьФорму("Обработка.НерекомендуемаяВерсияПлатформы.Форма.ПорядокОбновленияПлатформы",,ЭтотОбъект);
КонецПроцедуры


&НаКлиенте
Процедура ПродолжитьРаботу(Команда)
	ДействиеОпределено = Истина;
	Закрыть("Продолжить");
КонецПроцедуры

&НаКлиенте
Процедура ЗавершитьРаботу(Команда)
	ДействиеОпределено = Истина;
	Если НЕ ПропуститьЗавершениеРаботы Тогда
		ПрекратитьРаботуСистемы();
	КонецЕсли;

	Закрыть();
КонецПроцедуры
